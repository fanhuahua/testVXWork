(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-511c2b82"],{"03e2":function(e,t,o){},"2e57":function(e,t,o){},"337a":function(e,t,o){"use strict";o.r(t);o("b0c0");var n=o("7a23"),a=Object(n["withScopeId"])("data-v-84d8b090");Object(n["pushScopeId"])("data-v-84d8b090");var c={class:"kFormWrap"},r={class:"formTitle"};Object(n["popScopeId"])();var i=a((function(e,t,o,i,l,s){var u=Object(n["resolveComponent"])("van-empty"),d=Object(n["resolveComponent"])("KFormBuild"),b=Object(n["resolveComponent"])("approval-wb"),m=Object(n["resolveComponent"])("s-loading");return i.state.error?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:0,image:"error",description:i.state.error},null,8,["description"])):(Object(n["openBlock"])(),Object(n["createBlock"])(m,{key:1,loading:i.state.loading},{default:a((function(){return[Object(n["createVNode"])(b,Object(n["mergeProps"])(i.flowState,{authority:"view"!=e.$route.query.type?i.flowState.authority:{},"is-work-flow":!!i.flowState.procDefKey,beforeSubmitValidate:i.beforeSubmitValidate,onSubmit:i.onSubmit}),{default:a((function(){return[Object(n["createVNode"])("div",c,[Object(n["createVNode"])("h2",r,Object(n["toDisplayString"])(i.state.formSetInfo.name),1),Object(n["createVNode"])(d,{disabled:i.state.disabled,formDesign:i.state.formDesign,"form-state":i.state.formData,ref:"form",onHandleSubmit:i.handleSubmit},null,8,["disabled","formDesign","form-state","onHandleSubmit"])])]})),_:1},16,["authority","is-work-flow","beforeSubmitValidate","onSubmit"])]})),_:1},8,["loading"]))})),l=o("c964"),s=(o("e7e5"),o("d399")),u=o("d0af"),d=(o("96cf"),o("d3b7"),o("3ca3"),o("ddb0"),o("caad"),o("4de4"),o("b64b"),o("d81d"),o("7834")),b=o("6c02"),m=o("c5e6"),f=Object(n["withScopeId"])("data-v-66e8272c");Object(n["pushScopeId"])("data-v-66e8272c");var p={class:"approval-common"},v=Object(n["createVNode"])("div",{class:"approval-head"},null,-1),j={class:"approval-content"},h={class:"approval-foot"};Object(n["popScopeId"])();var O=f((function(e,t,o,a,c,r){var i=Object(n["resolveComponent"])("approval-process"),l=Object(n["resolveComponent"])("van-action-bar-icon"),s=Object(n["resolveComponent"])("van-action-bar-button"),u=Object(n["resolveComponent"])("approval-buttons"),d=Object(n["resolveComponent"])("van-action-bar"),b=Object(n["resolveComponent"])("approval-wb-modal");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])("div",p,[v,Object(n["createVNode"])("div",j,[Object(n["renderSlot"])(e.$slots,"default",{},void 0,!0)]),Object(n["createVNode"])("div",h,[o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(i,{key:0,style:{"margin-bottom":"10px"},"row-id":o.rowId},null,8,["row-id"])):Object(n["createCommentVNode"])("",!0),a.visible?(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:1},{default:f((function(){return[a.showBack?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,class:{disabledIcon:o.btnLoading},icon:"arrow-left",text:"返回",loading:o.btnLoading,onClick:t[1]||(t[1]=function(e){return!o.btnLoading&&a.back()})},null,8,["class","loading"])):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{authority:o.authority},{edit:f((function(){return[Object(n["createVNode"])(s,{type:"danger",text:"保存",loading:o.btnLoading,onClick:t[2]||(t[2]=function(e){return a.handleOk(0)})},null,8,["loading"]),o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:0,type:"danger",text:"提交",loading:o.btnLoading,onClick:t[3]||(t[3]=function(e){return a.handleOk(9)})},null,8,["loading"])):Object(n["createCommentVNode"])("",!0)]})),che:f((function(){return[o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,class:{disabledIcon:o.btnLoading},icon:"revoke",text:o.authority.canChe||"撤回",onClick:t[4]||(t[4]=function(e){return!o.btnLoading&&a.handleOk(3)})},null,8,["class","text"])):Object(n["createCommentVNode"])("",!0)]})),forward:f((function(){return[o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,class:{disabledIcon:o.btnLoading},icon:"share-o",text:o.authority.canForward||"转发",onClick:t[5]||(t[5]=function(e){return!o.btnLoading&&a.handleOk(5)})},null,8,["class","text"])):Object(n["createCommentVNode"])("",!0)]})),tui:f((function(){return[o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,class:{disabledIcon:o.btnLoading},icon:"down",text:o.authority.canTui||"退回",onClick:t[6]||(t[6]=function(e){return!o.btnLoading&&a.handleOk(4)})},null,8,["class","text"])):Object(n["createCommentVNode"])("",!0)]})),addSign:f((function(){return[o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,class:{disabledIcon:o.btnLoading},icon:"plus",text:o.authority.canAddSign||"加签",onClick:t[7]||(t[7]=function(e){return!o.btnLoading&&a.handleOk(7)})},null,8,["class","text"])):Object(n["createCommentVNode"])("",!0)]})),refuse:f((function(){return[o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,class:{disabledIcon:o.btnLoading},icon:"failure",text:o.authority.canRefuse||"拒绝",onClick:t[8]||(t[8]=function(e){return!o.btnLoading&&a.handleOk(2)})},null,8,["class","text"])):Object(n["createCommentVNode"])("",!0)]})),pass:f((function(){return[o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:0,type:"danger",text:o.authority.canPass||"同意",loading:o.btnLoading,onClick:t[9]||(t[9]=function(e){return a.handleOk(1)})},null,8,["text","loading"])):Object(n["createCommentVNode"])("",!0)]})),_:1},8,["authority"])]})),_:1})):Object(n["createCommentVNode"])("",!0)])]),o.isWorkFlow?(Object(n["openBlock"])(),Object(n["createBlock"])(b,{key:0,ref:"approvalRef",authority:o.authority,processInstanceId:o.processInstanceId,chooseParams:o.chooseParams,taskId:o.taskId,"proc-def-key":o.procDefKey,"org-id":o.orgId},null,8,["authority","processInstanceId","chooseParams","taskId","proc-def-key","org-id"])):Object(n["createCommentVNode"])("",!0)],64)})),g=o("fc11"),k=(o("7279"),o("a792")),y=(o("71ba"),o("a3f9")),w=(o("21f7"),o("d3d4")),V=(o("a9e3"),Object(n["withScopeId"])("data-v-788b984c"));Object(n["pushScopeId"])("data-v-788b984c");var C={key:0,class:"tipWrap"},N={key:1,class:"tipWrap"},I={key:2},S={class:"btns"},x=Object(n["createTextVNode"])(" 取消 "),B=Object(n["createTextVNode"])(" 确定 ");Object(n["popScopeId"])();var L=V((function(e,t,o,a,c,r){var i=Object(n["resolveComponent"])("tuihui"),l=Object(n["resolveComponent"])("van-field"),s=Object(n["resolveComponent"])("xygspr"),u=Object(n["resolveComponent"])("xygsprMult"),d=Object(n["resolveComponent"])("s-check-box"),b=Object(n["resolveComponent"])("s-picker"),m=Object(n["resolveComponent"])("van-form"),f=Object(n["resolveComponent"])("s-loading"),p=Object(n["resolveComponent"])("van-button"),v=Object(n["resolveComponent"])("van-popup");return Object(n["openBlock"])(),Object(n["createBlock"])(v,{show:e.visible,"onUpdate:show":t[3]||(t[3]=function(t){return e.visible=t}),position:"bottom"},{default:V((function(){return[Object(n["createVNode"])(f,{loading:e.$wait.is("chooseAssignee")||e.$wait.is("allUserList")},{default:V((function(){return[3===e.action?(Object(n["openBlock"])(),Object(n["createBlock"])("div",C,"是否确认撤回该流程?")):0===e.action&&o.processInstanceId?(Object(n["openBlock"])(),Object(n["createBlock"])("div",N," 是否保存该数据? ")):(Object(n["openBlock"])(),Object(n["createBlock"])("div",I,[e.visible?(Object(n["openBlock"])(),Object(n["createBlock"])(m,{key:0,ref:function(t){return e.formRef=t},onSubmit:a.onSubmit},{default:V((function(){return[4===e.action?(Object(n["openBlock"])(),Object(n["createBlock"])(i,{key:0,rejectTaskList:e.rejectTaskList,ref:function(t){return e.refData.tuihui=t},processInstanceId:o.processInstanceId},null,8,["rejectTaskList","processInstanceId"])):Object(n["createCommentVNode"])("",!0),4!==e.action&&2!==e.action&&5!==e.action?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:1,name:"xygspjd",label:"下一节点",modelValue:e.nextName,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.nextName=t}),disabled:"",placeholder:"请输入"},null,8,["modelValue"])):Object(n["createCommentVNode"])("",!0),1!==e.action&&9!==e.action||"结束"===e.nextName||e.multiInstance?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:2,assigneeList:e.assigneeList,ref:function(t){return e.refData.xygspr=t}},null,8,["assigneeList"])),1!==e.action&&9!==e.action||"结束"===e.nextName||!e.multiInstance?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:3,assigneeList:e.assigneeList,ref:function(t){return e.refData.xygsprMult=t}},null,8,["assigneeList"])),r.showCc?(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:4,name:"ccList",label:"抄送人",columns:c.userList,"is-search":"",option:{label:"realName",value:"userName"},"search-fuc":r.searchCcUser},null,8,["columns","search-fuc"])):Object(n["createCommentVNode"])("",!0),o.authority.canForward&&5===e.action?(Object(n["openBlock"])(),Object(n["createBlock"])(b,{key:5,name:"forwardName",placeholder:"请选择转发人",label:"转发人",ref:"forWardRef",rules:[{required:!0,message:"请选择"}],columns:c.forwardList,"columns-field-names":{text:"nickName",setValue:"userName"}},null,8,["columns"])):Object(n["createCommentVNode"])("",!0),o.authority.canAddSign&&7===e.action?(Object(n["openBlock"])(),Object(n["createBlock"])(b,{key:6,name:"forwardName",placeholder:"请选择加签人",label:"加签人",ref:"forWardRef",rules:[{required:!0,message:"请选择"}],columns:c.forwardList,"columns-field-names":{text:"nickName",setValue:"userName"}},null,8,["columns"])):Object(n["createCommentVNode"])("",!0),(void 0==e.spyj?o.processInstanceId&&1===e.action||2===e.action||4===e.action||5===e.action:e.spyj&&3!=e.spyj)?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:7,required:1==e.spyj||2!=e.spyj,modelValue:e.comment,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.comment=t}),rows:"2",autosize:"",name:"comment",label:"意见",type:"textarea",placeholder:"请输入",maxlength:"200","show-word-limit":"",rules:[{required:1==e.spyj||2!=e.spyj,message:"请选择"}]},null,8,["required","modelValue","rules"])):Object(n["createCommentVNode"])("",!0)]})),_:1},8,["onSubmit"])):Object(n["createCommentVNode"])("",!0)]))]})),_:1},8,["loading"]),Object(n["createVNode"])("div",S,[Object(n["createVNode"])(p,{class:"bottomBtn",round:"",onClick:r.handleRest},{default:V((function(){return[x]})),_:1},8,["onClick"]),Object(n["createVNode"])(p,{class:"bottomBtn",round:"",type:"primary",onClick:a.handleSubmit},{default:V((function(){return[B]})),_:1},8,["onClick"])])]})),_:1},8,["show"])})),D=o("f3f3"),F=(o("2532"),o("ac1f"),o("1276"),o("159b"),o("eab0")),_=o("6ff2"),P=o("8491"),T=o("2934"),A=o("3631"),R=Object(n["withScopeId"])("data-v-3a6c0a36");Object(n["pushScopeId"])("data-v-3a6c0a36");var $={class:"dh-field"},W={class:"van-hairline--bottom"},U={class:"van-picker__toolbar"},q={class:"van-ellipsis van-picker__title"},K={class:"checkbox-con",style:{"max-height":"264px","overflow-y":"auto"}};Object(n["popScopeId"])();var E=R((function(e,t,o,a,c,r){var i=Object(n["resolveComponent"])("van-field"),l=Object(n["resolveComponent"])("van-search"),s=Object(n["resolveComponent"])("van-checkbox"),u=Object(n["resolveComponent"])("van-cell"),d=Object(n["resolveComponent"])("van-empty"),b=Object(n["resolveComponent"])("van-cell-group"),m=Object(n["resolveComponent"])("van-checkbox-group"),f=Object(n["resolveComponent"])("s-loading"),p=Object(n["resolveComponent"])("van-popup");return Object(n["openBlock"])(),Object(n["createBlock"])("div",$,[Object(n["withDirectives"])(Object(n["createVNode"])(i,{name:o.name,modelValue:r.resultValue,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.resultValue=e})},null,8,["name","modelValue"]),[[n["vShow"],!1]]),Object(n["createVNode"])("div",W,[Object(n["createVNode"])(i,Object(n["mergeProps"])({modelValue:r.resultLabel,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.resultLabel=e})},e.$attrs,{readonly:"","is-link":void 0===e.$attrs.disabled,"error-message-align":"right","input-align":"right",onClick:t[3]||(t[3]=function(t){return r.showPopu(e.$attrs.disabled)}),class:"dh-cell"}),null,16,["modelValue","is-link"]),Object(n["createVNode"])(p,{show:c.show,"onUpdate:show":t[10]||(t[10]=function(e){return c.show=e}),position:"bottom",class:""},{default:R((function(){return[Object(n["createVNode"])("div",U,[Object(n["createVNode"])("button",{type:"button",class:"van-picker__cancel",onClick:t[4]||(t[4]=function(){return r.cancel&&r.cancel.apply(r,arguments)})}," 取消 "),Object(n["createVNode"])("div",q,Object(n["toDisplayString"])(e.$attrs.label),1),Object(n["createVNode"])("button",{type:"button",class:"van-picker__confirm",onClick:t[5]||(t[5]=function(){return r.onConfirm&&r.onConfirm.apply(r,arguments)})}," 确认 ")]),Object(n["createVNode"])("div",K,[o.isSearch?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,modelValue:c.searchVal,"onUpdate:modelValue":t[6]||(t[6]=function(e){return c.searchVal=e}),placeholder:"搜索","input-align":"left"},null,8,["modelValue"])):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(f,{loading:c.loading},{default:R((function(){return[o.columns.length?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:0,title:"全选"},{"right-icon":R((function(){return[Object(n["createVNode"])(s,{name:"all",onClick:r.toggleAll,modelValue:c.checkedAll,"onUpdate:modelValue":t[7]||(t[7]=function(e){return c.checkedAll=e})},null,8,["onClick","modelValue"])]})),_:1})):(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:1})),Object(n["createVNode"])(m,{modelValue:c.checkboxValue,"onUpdate:modelValue":t[9]||(t[9]=function(e){return c.checkboxValue=e}),onChange:r.change,ref:"checkboxGroup"},{default:R((function(){return[Object(n["createVNode"])(b,null,{default:R((function(){return[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(o.columns,(function(e,c){return Object(n["openBlock"])(),Object(n["createBlock"])(u,{clickable:"",key:e[o.option.value],title:e[o.option.label],onClick:function(e){return a.toggle(c)}},{"right-icon":R((function(){return[Object(n["createVNode"])(s,{onClick:t[8]||(t[8]=Object(n["withModifiers"])((function(){}),["stop"])),name:e,ref:function(e){return a.checkboxRefs[c]=e}},null,8,["name"])]})),_:2},1032,["title","onClick"])})),128))]})),_:1})]})),_:1},8,["modelValue","onChange"])]})),_:1},8,["loading"])])]})),_:1},8,["show"])])])})),M=(o("5852"),o("d961")),z=(o("a909"),o("3acc")),J=(o("3c32"),o("417e")),G=(o("a15b"),o("841c"),o("c740"),o("a434"),{name:"SCheckBox",components:{"van-checkbox":J["a"],"van-checkbox-group":z["a"],"van-search":M["a"],SLoading:m["a"]},model:{prop:"selectValue"},emits:["cancel","change","confirm"],props:{name:{type:String,required:!0},columns:{type:Array,default:function(){return[]}},option:{type:Object,default:function(){return{label:"label",value:"value"}}},isSearch:{type:Boolean,default:!1},searchFuc:Function},computed:{resultLabel:{get:function(){var e=this;return this.checkboxValue.map((function(t){return t[e.option.label]})).join(",")},set:function(){}},resultValue:{get:function(){var e=this;return this.checkboxValue.map((function(t){return t[e.option.value]})).join(",")}}},data:function(){return{show:!1,loading:!1,searchVal:"",checkboxValue:[],checkedAll:!1}},setup:function(){var e=Object(n["ref"])([]),t=function(t){e.value[t].toggle()};return Object(n["onBeforeUpdate"])((function(){e.value=[]})),{toggle:t,checkboxRefs:e}},methods:{search:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:t.loading=!0,t.searchFuc&&t.searchFuc(e),t.loading=!1;case 3:case"end":return o.stop()}}),o)})))()},getData:function(e){var t=this,o=e.map((function(e){return e[t.option.value]}));return this.columns.filter((function(e){return o.indexOf(e[t.option.value])>-1}))},onConfirm:function(){var e=this;this.show=!this.show,this.$emit("confirm",this.checkboxValue.map((function(t){return t[e.option.value]})).join(","),this.getData(this.checkboxValue))},change:function(e){var t=this;this.$emit("change",e.map((function(e){return e[t.option.value]})).join(","),this.getData(this.checkboxValue))},cancel:function(){var e=this;this.show=!this.show,this.$emit("cancel",this.checkboxValue.map((function(t){return t[e.option.value]})).join(","))},toggleAll:function(){this.$refs.checkboxGroup.toggleAll(this.checkedAll)},showPopu:function(e){if(void 0!==e&&!1!==e)return!1;this.show=!this.show}},watch:{searchVal:function(e){this.search(e)},columns:{deep:!0,immediate:!0,handler:function(e){var t=this;if(this.resultValue&&e&&e.length){var o=this.resultValue.split(",");e.map((function(n,a){var c=o.findIndex((function(e){return n[t.option.value]==e}));-1!=c&&t.checkboxValue.splice(c,1,e[a])}))}}}}});o("88e7");G.render=E,G.__scopeId="data-v-3a6c0a36";var H=G,Q={name:"ApprovalWbModal",components:{SCheckBox:H,SPicker:A["a"],tuihui:F["a"],xygspr:_["a"],xygsprMult:P["a"],SLoading:m["a"]},props:{authority:{type:Object,default:function(){return{}}},procDefKey:{type:[String,Number],default:void 0},processInstanceId:{type:[String,Number],default:void 0},taskId:{type:[String,Number],default:void 0},orgId:{type:[String,Number],default:void 0},params:{type:Object,default:function(){return{}}},chooseParams:{type:Object,default:function(){return{}}}},data:function(){return{forwardList:[],userList:[]}},computed:{showCc:function(e){var t=e.action,o=e.authority;return(null===o||void 0===o?void 0:o.canCc)&&(1===t||9===t||2===t)}},setup:function(e){var t=Object(n["reactive"])({comment:"",visible:!1,refData:{},formRef:null,spyj:void 0,validatedForm:{},action:0,myPromise:void 0,rejectTaskList:[],assigneeList:[],multiInstance:!1,nextName:void 0}),o=Object(n["ref"])(null),a=function(e){return"string"===typeof e?e.includes(",")?e.split(","):[e]:e},c=function(){var n,c,r,i,l,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=null!==u&&void 0!==u&&u.assigneeList?a(u.assigneeList):[],b=null===(n=o.value)||void 0===n||null===(c=n.state)||void 0===c?void 0:c.selected.value;null===(r=t.myPromise)||void 0===r||r.resolve(Object(D["a"])(Object(D["a"])({},u),{},{forwardName:b||u.forwardName,assigneeList:d,ccList:(null===(i=u.ccList)||void 0===i?void 0:i.split(","))||[],processInstanceId:t.processInstanceId||(null===(l=t.validatedForm)||void 0===l?void 0:l.processInstanceId)||e.processInstanceId,taskId:t.taskId||(null===(s=t.validatedForm)||void 0===s?void 0:s.taskId)||e.taskId,action:t.action,variables:t.chooseParams||e.chooseParams}))},r=function(){3===t.action||0===t.action&&e.processInstanceId?c():t.formRef.submit()},i=function(e){c(e)},l=function(){t.visible=!0},s=function(){t.visible=!1},u=function(){var e=Object.keys(t.refData);e.length>0&&e.forEach((function(e){var o;null===(o=t.refData[e])||void 0===o||o.restData()})),t.visible=!1};return Object(D["a"])(Object(D["a"])({},Object(n["toRefs"])(t)),{},{forWardRef:o,onSubmit:i,showPopup:l,handleCancel:s,resetForm:u,handleSubmit:r})},methods:{getAddSignList:function(e){var t=this;Object(T["b"])({pageNum:1,pageSize:10,nickName:e}).then((function(e){t.forwardList=e.rows}))},searchCcUser:function(e){var t=this;return Object(T["i"])({pageNum:1,pageSize:10,realName:e,orgId:this.orgId}).then((function(e){return t.userList=e.data.rows||[],e.data.rows}))},handleOk:function(){this.$refs.form.submit()},handleRest:function(){this.resetForm()},getForwardList:function(){var e=this;Object(T["d"])(Object(D["a"])({processInstanceId:this.processInstanceId,procDefKey:this.procDefKey,skip:0},this.chooseParams)).then((function(t){e.forwardList=t.data.assigneeList}))},getNextList:function(){var e=this;Object(T["d"])(Object(D["a"])(Object(D["a"])({processInstanceId:this.processInstanceId,procDefKey:this.procDefKey,skip:1},this.chooseParams),{},{formData:this.validatedForm.applyInfo})).then((function(t){var o=t.data,n=o.multiInstance,a=o.assigneeList,c=o.name,r=o.spyj;e.assigneeList=a,e.multiInstance=n,e.spyj=r,e.nextName=c}))},getRejectList:function(){var e=this;Object(T["l"])({processInstanceId:this.processInstanceId}).then((function(t){e.rejectTaskList=t.data}))},startApproval:function(e,t){var o=this;return this.validatedForm=e,this.action=t,this.visible=!0,new Promise((function(e,t){o.myPromise={resolve:e,reject:t}}))}},watch:{visible:function(e){!this.userList.length&&this.showCc&&this.searchCcUser(),e&&(this.validatedForm.id?7===this.action?this.getAddSignList():5===this.action?this.getForwardList():4===this.action?this.getRejectList():1!==this.action&&9!==this.action||this.getNextList():this.getNextList())}}};o("81d2");Q.render=L,Q.__scopeId="data-v-788b984c";var X=Q,Y=Object(n["createVNode"])("div",{style:{margin:"12px","font-size":"16px"}},"审批流程",-1),Z={style:{padding:"0 10px"}},ee={style:{color:"rgba(0, 0, 0, 0.85)"}},te={style:{color:"rgba(0, 0, 0, 0.45)"}},oe={style:{color:"rgba(18, 28, 37, 0.65)"}},ne={style:{color:"rgba(18, 28, 37, 0.45)","text-align":"right"}};function ae(e,t,o,a,c,r){var i=Object(n["resolveComponent"])("van-col"),l=Object(n["resolveComponent"])("van-row"),s=Object(n["resolveComponent"])("van-step"),u=Object(n["resolveComponent"])("van-steps"),d=Object(n["resolveComponent"])("van-empty"),b=Object(n["resolveComponent"])("van-cell-group");return Object(n["openBlock"])(),Object(n["createBlock"])(b,{inset:""},{default:Object(n["withCtx"])((function(){return[Y,Object(n["withDirectives"])(Object(n["createVNode"])(u,{direction:"vertical"},{default:Object(n["withCtx"])((function(){return[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(c.timeLineData,(function(e,t){return Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:t},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(l,{type:"flex"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(i,{span:16},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])("div",Z,[Object(n["createVNode"])("div",ee,Object(n["toDisplayString"])(e.taskName),1),Object(n["createVNode"])("div",te,Object(n["toDisplayString"])(e.auditNickName)+"（"+Object(n["toDisplayString"])(e.auditTypeName)+"） ",1),Object(n["createVNode"])("div",oe,Object(n["toDisplayString"])(e.auditNote&&"审批意见:".concat(e.auditNote)),1)])]})),_:2},1024),Object(n["createVNode"])(i,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])("div",ne,Object(n["toDisplayString"])(e.auditTime),1)]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128)),Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(" 当前节点："+Object(n["toDisplayString"])(c.currentName),1)]})),_:1})]})),_:1},512),[[n["vShow"],c.timeLineData.length]]),Object(n["withDirectives"])(Object(n["createVNode"])(d,null,null,512),[[n["vShow"],!c.timeLineData.length]])]})),_:1})}o("91d5");var ce,re=o("f0ca"),ie=(o("1f87"),o("510b")),le=(o("77f8"),o("dc0f")),se={name:"ApprovalWbProcess",props:{rowId:{type:[String,Number],default:void 0}},data:function(){return{timeLineData:[],currentName:void 0}},components:(ce={},Object(g["a"])(ce,le["a"].name,le["a"]),Object(g["a"])(ce,ie["a"].name,ie["a"]),Object(g["a"])(ce,re["a"].name,re["a"]),ce),watch:{rowId:{immediate:!0,handler:function(e){e?this.getViewTask(e):(this.timeLineData=[],this.currentName=void 0)}}},created:function(){},methods:{getViewTask:function(e){var t=this;Object(T["p"])({rowId:e}).then((function(e){var o;(null===(o=e.data)||void 0===o?void 0:o.length)>1?(t.timeLineData=e.data,t.currentName=t.timeLineData.pop().taskName):(t.timeLineData=[],t.currentName=!1)}))}}};se.render=ae;var ue=se;function de(e,t,o,a,c,r){return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["renderSlot"])(e.$slots,"cancel"),o.authority&&o.authority.canEdit?Object(n["renderSlot"])(e.$slots,"edit",{key:0}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canAddSign?Object(n["renderSlot"])(e.$slots,"addSign",{key:1}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canChe?Object(n["renderSlot"])(e.$slots,"che",{key:2}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canTui?Object(n["renderSlot"])(e.$slots,"tui",{key:3}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canRefuse?Object(n["renderSlot"])(e.$slots,"refuse",{key:4}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canForward?Object(n["renderSlot"])(e.$slots,"forward",{key:5}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canApproval?Object(n["renderSlot"])(e.$slots,"approval",{key:6}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canPass?Object(n["renderSlot"])(e.$slots,"pass",{key:7}):Object(n["createCommentVNode"])("",!0),o.authority&&o.authority.canPrint?Object(n["renderSlot"])(e.$slots,"print",{key:8}):Object(n["createCommentVNode"])("",!0)],64)}var be={name:"ApprovalWbButtons",props:{authority:{type:Object,default:function(){return{}}}}};be.render=de;var me,fe=be,pe=o("ca00"),ve={name:"ApprovalWb",components:(me={ApprovalButtons:fe,ApprovalProcess:ue,ApprovalWbModal:X},Object(g["a"])(me,w["b"].name,w["b"]),Object(g["a"])(me,y["a"].name,y["a"]),Object(g["a"])(me,k["b"].name,k["b"]),me),props:{btnLoading:Boolean,id:String,chooseParams:Object,applyInfo:Object,authority:{type:Object,default:function(){return{}}},procDefKey:{type:[String,Number],default:void 0},rowId:{type:[String,Number],default:void 0},processInstanceId:{type:[String,Number],default:void 0},taskId:{type:[String,Number],default:void 0},taskName:{type:String,default:""},beforeSubmitValidate:[Function,Promise],isWorkFlow:{type:Boolean,default:!0},orgId:{type:[String,Number],default:void 0}},emits:["submit","cancel"],setup:function(e,t){var o=Object(n["ref"])(!!window.history.state.back),a=Object(n["ref"])(null),c=function(){var o=Object(l["a"])(regeneratorRuntime.mark((function o(n){var c,r;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(o.t0=e.beforeSubmitValidate,!o.t0){o.next=4;break}return o.next=4,e.beforeSubmitValidate(n);case 4:c=Object(pe["h"])(e,["beforeSubmitValidate","btnLoading","chooseParams","isWorkFlow"]),e.isWorkFlow&&0!==n?null===(r=a.value)||void 0===r||r.startApproval(c,n).then((function(e){var o;t.emit("submit",e,n),null===(o=a.value)||void 0===o||o.resetForm()})):t.emit("submit",{action:n},n);case 6:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}(),r=function(){t.emit("cancel")},i=Object(b["d"])(),s=i.back,u=Object(n["toRefs"])(e),d=u.authority,m=Object(n["computed"])((function(){return d.value.canEdit||d.value.canChe||d.value.canTui||d.value.canApproval||d.value.canForward||d.value.canCc}));return{back:s,handleOk:c,handleCancel:r,approvalRef:a,visible:m,showBack:o}}};o("ff2e");ve.render=O,ve.__scopeId="data-v-66e8272c";var je=ve,he=o("6f1d"),Oe=o("4360"),ge=(o("3530"),{name:"designForm",components:{ApprovalWb:je,SLoading:m["a"]},setup:function(e,t){var o,a,c=Object(b["d"])(),r=Object(b["c"])(),i=r.name,m=r.query,f=r.meta.disabled,p=void 0!==f&&f;Oe["a"].commit("SET_SUBMITTOKEN",m.token);var v={id:m.id,rowId:m.rowId},j=Object(n["ref"])(null),h=Object(n["reactive"])({formDesign:[],formSetInfo:{},kFormDsgRef:void 0,formData:{},fieldAuth:null,loading:!1,disabled:p,error:"",formTrigger:null}),O=Object(n["reactive"])({id:v.rowId,authority:{canEdit:!1},processInstanceId:void 0,taskId:void 0,taskName:void 0,procDefKey:void 0,applyInfo:{},btnLoading:!1,orgId:void 0,rowId:m.rowId});if(v.id){h.loading=!0;var g=[Object(d["a"])(v)];v.rowId&&v.id&&g.push(Object(d["b"])(v,"")),Promise.all(g).then((function(e){var t=Object(u["a"])(e,2),o=t[0],a=t[1];if(p||(O.authority={canEdit:!0}),0===(null===o||void 0===o?void 0:o.code)){var c,r=o.data,i=r.formDesignJson,l=(r.name,r.orgId),s=r.formTrigger;h.formSetInfo=Object(pe["k"])(o.data,["id","name"]);var d=JSON.parse(i);if(0===(null===d||void 0===d||null===(c=d.list)||void 0===c?void 0:c.length))return;!h.designObj&&d.list&&(h.designObj={},Object(pe["g"])(d.list,(function(e){h.designObj[e.model]=e}))),h.formDesign=d.list,h.formTrigger=s,O.orgId=l,O.procDefKey=o.data.procDefKey,v.rowId||"1"!=s.triggerCondition||k()}if(0===(null===a||void 0===a?void 0:a.code)){var b,m;if(null!==(b=a.data)&&void 0!==b&&b.extral){var f,g;if(Object.assign(O,null===(f=a.data)||void 0===f?void 0:f.extral),p)return void(O.authority={canEdit:!1});h.fieldAuth=null===(g=a.data)||void 0===g?void 0:g.fieldAuth,Object(n["nextTick"])((function(){var e,t;h.fieldAuth?j.value.setFormOptions(null===(e=a.data)||void 0===e?void 0:e.fieldAuth):h.disabled=!(null!==(t=O.authority)&&void 0!==t&&t.canEdit)}))}h.formData=null===(m=a.data)||void 0===m?void 0:m.data}})).catch((function(e){var t,o;h.error=(null===(t=e.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.msg)||e.message})).finally((function(){h.loading=!1}))}else h.error="无表单id";var k=function(){var e,n;if(null!==(e=h.formTrigger)&&void 0!==e&&null!==(n=e.triggerList)&&void 0!==n&&n.length){var c,r;if(!o)o={options:{orginTableId:v.id,executeType:null===(c=h.formTrigger)||void 0===c?void 0:c.executeType,triggerList:null===(r=h.formTrigger)||void 0===r?void 0:r.triggerList}},a=Object(he["a"])({record:o,formState:{},emit:t.emit,props:{}}).executeTriggerConcurrency;a().then((function(e){h.formData=e}))}};Object(n["watchEffect"])((function(){var e;O.procDefKey&&(O.applyInfo=null===(e=j.value)||void 0===e?void 0:e.state.formState)}));var y=function(e){return[2,3,4].includes(e)},w=function(e){v.rowId?N(Object(d["s"])(v.id,v.rowId,e),"操作成功",!0,(function(){var t;v.rowId&&0==e.task.action&&"3"==(null===(t=h.formTrigger)||void 0===t?void 0:t.triggerCondition)&&k()})):N(Object(d["r"])(v.id,e),"新增成功",!0,(function(){var t;v.rowId||0!=e.task.action||"2"!=(null===(t=h.formTrigger)||void 0===t?void 0:t.triggerCondition)||k()}))},V=function(e){var t,o={task:e};y(e.action)||(o.data=null===(t=j.value)||void 0===t?void 0:t.onSubmit());if(h.disabled)w(o);else{var n=S(o);n.length?C(0,n,o.data,(function(t){w({data:t,task:e})})):w(o)}},C=function e(o,n,a,c){o>=n.length&&c(a);var r=Object(he["a"])({record:h.designObj[n[o]],formState:a,emit:t.emit,props:{}}),i=r.executeTriggerConcurrency;i().then((function(t){a=Object.assign(a,t),e(++o,n,a,c)}))},N=function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;O.btnLoading=!0,null===e||void 0===e||e.then((function(e){0===e.code&&(Object(s["a"])({type:"success",message:t,duration:1e3}),"function"==typeof n&&n(),!o&&!v.rowId&&(v.rowId=e.data),o&&("publicSubmit"==i?c.push({name:"submitSuccess"}):c.back()))})).finally((function(){O.btnLoading=!1}))},I=function(e){var t;return!!y(e)||(null===(t=j.value)||void 0===t?void 0:t.validata())},S=function(e){var t=Object.keys(e.data).filter((function(e){return"uploadImg"==h.designObj[e].type})),o=[];return t.map((function(e){"save"==h.designObj[e].options.executeTime&&o.push(e)})),o},x=function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,I(0);case 2:v.rowId?N(Object(d["s"])(v.id,v.rowId,{data:t,task:{action:0}}),"操作成功",!1):N(Object(d["r"])(v.id,{data:t,task:{action:0}}),"新增成功",!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e;null===(e=j.value)||void 0===e||e.onReset()};return{state:h,form:j,flowState:O,onSubmit:V,onReset:B,beforeSubmitValidate:I,handleSubmit:x}}});o("76cf");ge.render=i,ge.__scopeId="data-v-84d8b090";t["default"]=ge},3631:function(e,t,o){"use strict";o("b0c0");var n=o("7a23");function a(e,t,o,a,c,r){var i=Object(n["resolveComponent"])("van-field"),l=Object(n["resolveComponent"])("van-picker"),s=Object(n["resolveComponent"])("van-popup");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(i,{name:o.name,required:a.required,modelValue:a.state.selected.text,"onUpdate:modelValue":t[1]||(t[1]=function(e){return a.state.selected.text=e}),"is-link":!a.computedDisabled,readonly:"",disabled:a.computedDisabled,onClick:a.onClick,placeholder:o.placeholder,rules:o.rules,columnsFieldNames:o.columnsFieldNames,label:o.label},null,8,["name","required","modelValue","is-link","disabled","onClick","placeholder","rules","columnsFieldNames","label"]),Object(n["createVNode"])(s,{show:a.state.showPicker,"onUpdate:show":t[3]||(t[3]=function(e){return a.state.showPicker=e}),position:o.position},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(l,{columns:a.sColumns,loading:o.loading,"columns-field-names":o.columnsFieldNames,onConfirm:a.onConfirm,onCancel:t[2]||(t[2]=function(e){return a.state.showPicker=!1})},Object(n["createSlots"])({"columns-top":Object(n["withCtx"])((function(){return[Object(n["renderSlot"])(e.$slots,"columns-top")]})),_:2},[e.$slots.option?{name:"option",fn:Object(n["withCtx"])((function(t){return[Object(n["renderSlot"])(e.$slots,"option",t)]}))}:void 0]),1032,["columns","loading","columns-field-names","onConfirm"])]})),_:1},8,["show","position"])],64)}var c=o("0122"),r=o("d0af"),i=(o("7db0"),o("159b"),o("b64b"),o("2ca0"),o("ac1f"),o("1276"),o("e6b2")),l=o("ca00"),s=o("b48e"),u={name:"SPicker",emits:["click"],props:{modelValue:String,name:{type:String,required:!0},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},columns:{type:Array,default:function(){return[]}},rules:{type:Array,default:function(){return[]}},position:{type:String,default:"bottom"},disabled:{type:Boolean,default:void 0},loading:Boolean,dictName:String,columnsFieldNames:{type:Object,default:function(){return{setValue:void 0,text:"text",values:"values",children:"children"}}}},setup:function(e,t){var o=Object(n["reactive"])({showPicker:!1,selected:{value:"",text:""}}),a=Object(i["a"])(Object(n["toRefs"])(e).disabled),u=Object(n["computed"])((function(){return!!e.rules.find((function(e){return e.required}))})),d=Object(n["toRefs"])(e),b=d.columnsFieldNames,m=d.columns,f=e.dictName?Object(s["b"])([e.dictName])[e.dictName]:m;Object(n["watch"])([function(){return e.modelValue},function(){return f.value}],(function(e,t){var n=Object(r["a"])(e,2),a=n[0],c=n[1],i=Object(r["a"])(t,2),s=(i[0],i[1],b.value.setValue),u=b.value.text,d=!0;if(s&&!Object(l["f"])(a)&&c.length){var m=c.find((function(e){return e[s]===a}));m&&(o.selected.text=m[u],o.selected.value=m[s],d=!1)}d&&(o.selected.text=a,o.selected.value=a)}),{immediate:!0});var p=function(e){t.emit("fbztChange",e.value),t.emit("ssyxChange",e),o.showPicker=!1;var n={value:e,text:e};"object"===Object(c["a"])(e)&&b.value.setValue&&(n.value=e[b.value.setValue],n.text=e[b.value.text]),o.selected=n,Object.keys(t.attrs).forEach((function(o){if(o.startsWith("onUpdate:")){var a=o.split("onUpdate:")[1];t.emit("update:".concat(a),"modelValue"===a?n.value:e[a])}}))},v=function(){!a.value&&(o.showPicker=!0),t.emit("click",{disabled:a.value})};return{state:o,computedDisabled:a,onConfirm:p,onClick:v,required:u,sColumns:f}}};u.render=a;t["a"]=u},"50c3":function(e,t,o){},"76cf":function(e,t,o){"use strict";o("a1c9")},"81d2":function(e,t,o){"use strict";o("50c3")},"88e7":function(e,t,o){"use strict";o("2e57")},a1c9:function(e,t,o){},ff2e:function(e,t,o){"use strict";o("03e2")}}]);